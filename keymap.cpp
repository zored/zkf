extern "C" {
#include QMK_KEYBOARD_H
}

enum Backlight: uint8_t {
#ifdef BACKLIGHT_BREATHING
    BREATHING,
#endif
    OFF,
    ON
};

enum Fn: uint8_t {
    BACKLIGHT = 0
};

static Backlight backlight = Backlight::ON;

void action_function(keyrecord_t *record, uint8_t id, uint8_t opt) {
    switch(id) {
    case Fn::BACKLIGHT:
        if (record->event.pressed) {
            switch (backlight) {
            case Backlight::ON:
#ifdef BACKLIGHT_BREATHING
                breathing_enable();
                backlight = Backlight::BREATHING;
                break;
            case Backlight::BREATHING:
                breathing_disable();
#endif
                backlight_disable();
                backlight = Backlight::OFF;
                break;
            case Backlight::OFF:
                backlight_enable();
                backlight = Backlight::ON;
                break;
            }
        }
        break;
    }
}

const uint16_t fn_actions[] = {
    [0] = ACTION_LAYER_MOMENTARY(1),
    [1] = ACTION_LAYER_MOMENTARY(2),
    [2] = ACTION_FUNCTION(Fn::BACKLIGHT)
};

#include <util/keymap.hpp>

/* Number of keys for TrueFox layout */
#define KEYMAP_SIZE 68

constexpr std::array<std::array<keycode_t, KEYMAP_SIZE>, 2> layers = {
    layer(KEYMAP_SIZE, R"keymap(
â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚Escâ”‚ 1 â”‚ 2 â”‚ 3 â”‚ 4 â”‚ 5 â”‚ 6 â”‚ 7 â”‚ 8 â”‚ 9 â”‚ 0 â”‚ - â”‚ = â”‚ \ â”‚ `  â”‚Ins â”‚
â”œâ”€â”€â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚ Tab â”‚ Q â”‚ W â”‚ E â”‚ R â”‚ T â”‚ Y â”‚ U â”‚ I â”‚ O â”‚ P â”‚ [ â”‚ ] â”‚BSpc  â”‚Del â”‚
â”œâ”€â”€â”€â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚ Fn0  â”‚ A â”‚ S â”‚ D â”‚ F â”‚ G â”‚ H â”‚ J â”‚ K â”‚ L â”‚ ; â”‚ ' â”‚ Enter   â”‚Brk â”‚
â”œâ”€â”€â”€â”€â”€â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚ LShift â”‚ Z â”‚ X â”‚ C â”‚ V â”‚ B â”‚ N â”‚ M â”‚ , â”‚ . â”‚ / â”‚RShiftâ”‚ â†‘  â”‚App â”‚
â”œâ”€â”€â”€â”€â”¬â”€â”€â”€â”´â”¬â”€â”€â”´â”€â”¬â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”¬â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”¬â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚LCtlâ”‚LGuiâ”‚LAltâ”‚         Space          â”‚RAltâ”‚RCtl â”‚ â†  â”‚ â†“  â”‚ â†’  â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
)keymap"),
    layer(KEYMAP_SIZE, R"keymap(
â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚   â”‚ F1â”‚ F2â”‚ F3â”‚ F4â”‚ F5â”‚ F6â”‚ F7â”‚ F8â”‚ F9â”‚F10â”‚F11â”‚F12â”‚   â”‚Fn2 â”‚PScrâ”‚
â”œâ”€â”€â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚     â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚ â® â”‚ â¯ â”‚ â­ â”‚ ğŸ”‰â”‚ ğŸ”Šâ”‚  ğŸ”‡  â”‚RST â”‚
â”œâ”€â”€â”€â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚      â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚ â¹ â”‚ ğŸ”…â”‚ ğŸ”†â”‚         â”‚    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚ CAPS   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚ CAPS â”‚PgUpâ”‚    â”‚
â”œâ”€â”€â”€â”€â”¬â”€â”€â”€â”´â”¬â”€â”€â”´â”€â”¬â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”¬â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”¬â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚    â”‚    â”‚    â”‚                        â”‚    â”‚     â”‚Homeâ”‚PgDnâ”‚End â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
)keymap")
};

const uint16_t keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
    [0] = apply_array(LAYOUT_truefox, KEYMAP_SIZE, layers[0]),
    [1] = apply_array(LAYOUT_truefox, KEYMAP_SIZE, layers[1])
};
